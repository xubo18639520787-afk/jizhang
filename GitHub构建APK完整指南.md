# 🚀 GitHub Actions 构建 APK 完整指南

## 📋 前提条件检查

✅ **已完成的配置**
- GitHub Actions 工作流已配置 (`.github/workflows/android.yml`)
- 免费版本代码已准备就绪（无需API密钥）
- 签名配置已设置（支持自动签名）
- 所有依赖项已正确配置

## 🎯 构建步骤

### 1. 推送代码到GitHub

首先确保你的代码已经推送到GitHub仓库：

```bash
# 初始化Git仓库（如果还没有）
git init

# 添加所有文件
git add .

# 提交代码
git commit -m "完成个人记账应用开发 - 免费版本"

# 添加远程仓库（替换为你的仓库地址）
git remote add origin https://github.com/你的用户名/你的仓库名.git

# 推送到GitHub
git push -u origin main
```

### 2. 触发自动构建

推送代码后，GitHub Actions 会自动开始构建：

1. **访问你的GitHub仓库**
2. **点击 "Actions" 标签页**
3. **查看 "Build Android APK" 工作流**
4. **等待构建完成**（大约5-10分钟）

### 3. 下载构建的APK

构建完成后：

1. **点击最新的构建记录**
2. **滚动到页面底部的 "Artifacts" 部分**
3. **下载 "app-debug" 或 "app-release" 文件**
4. **解压下载的zip文件，获得APK**

## 🔧 构建配置详情

### 当前工作流特性

```yaml
# 触发条件
- push到main分支时自动构建
- 手动触发构建（workflow_dispatch）

# 构建环境
- Ubuntu最新版本
- Java 17
- Android SDK自动安装

# 构建输出
- Debug APK（用于测试）
- Release APK（用于发布，已签名）
```

### 免费版本优势

✅ **无需配置API密钥**
- 构建过程中不需要百度API配置
- 所有功能都可以正常使用
- 智能文本解析功能完全免费

✅ **自动签名配置**
- 使用调试签名（debug版本）
- 或使用自动生成的发布签名（release版本）

## 🎮 手动触发构建

如果需要手动触发构建：

1. **访问GitHub仓库的Actions页面**
2. **选择 "Build Android APK" 工作流**
3. **点击 "Run workflow" 按钮**
4. **选择分支（通常是main）**
5. **点击绿色的 "Run workflow" 按钮**

## 📱 APK安装和使用

### 安装APK

1. **下载APK到Android设备**
2. **启用"未知来源"安装**
   - 设置 → 安全 → 未知来源 → 开启
3. **点击APK文件安装**

### 首次使用

1. **打开应用**
2. **体验智能输入功能**
   - 在添加交易页面输入："午餐花了35元"
   - 应用会自动解析金额和分类
3. **探索所有功能**
   - 记账管理
   - 数据统计
   - 主题切换
   - 数据导出

## 🔍 构建故障排除

### 常见问题和解决方案

#### 1. 构建失败 - 依赖问题
```
解决方案：检查 build.gradle.kts 中的依赖版本
通常GitHub Actions会自动解决依赖问题
```

#### 2. 构建失败 - 内存不足
```
解决方案：已在gradle.properties中配置了内存优化
org.gradle.jvmargs=-Xmx4g -XX:MaxMetaspaceSize=512m
```

#### 3. 签名问题
```
解决方案：使用debug签名，无需额外配置
发布版本会自动生成临时签名
```

#### 4. API密钥错误
```
解决方案：免费版本无需API密钥
enableBaiduApi = false 已设置
```

### 查看构建日志

如果构建失败：

1. **点击失败的构建记录**
2. **点击 "build" 作业**
3. **展开失败的步骤查看详细日志**
4. **根据错误信息进行修复**

## 🎉 构建成功后的文件

构建成功后你会得到：

```
📦 构建产物
├── app-debug.apk          # 调试版本（推荐用于测试）
├── app-release.apk        # 发布版本（已优化和混淆）
└── mapping.txt            # 代码混淆映射文件
```

### APK文件说明

| 文件 | 用途 | 特点 |
|------|------|------|
| app-debug.apk | 开发测试 | 未混淆，便于调试 |
| app-release.apk | 正式发布 | 已混淆优化，体积更小 |

## 📊 构建时间预估

| 构建阶段 | 预估时间 | 说明 |
|----------|----------|------|
| 环境准备 | 1-2分钟 | 下载Java和Android SDK |
| 依赖下载 | 2-3分钟 | 下载项目依赖 |
| 代码编译 | 2-3分钟 | 编译Kotlin代码 |
| APK打包 | 1-2分钟 | 打包和签名 |
| **总计** | **6-10分钟** | 完整构建流程 |

## 🔄 持续集成优势

使用GitHub Actions的好处：

✅ **自动化构建**
- 每次代码更新自动构建
- 无需本地Java环境
- 云端资源，构建速度快

✅ **版本管理**
- 每次构建都有记录
- 可以下载历史版本APK
- 构建状态一目了然

✅ **多平台支持**
- 在云端Linux环境构建
- 兼容性更好
- 无本地环境依赖

## 🎯 下一步建议

构建成功后，你可以：

1. **安装测试APK**
2. **体验所有功能**
3. **收集用户反馈**
4. **根据需要进行功能迭代**
5. **考虑发布到应用商店**

## 📞 需要帮助？

如果在构建过程中遇到问题：

1. **检查构建日志**
2. **参考故障排除部分**
3. **提供具体的错误信息**
4. **我会帮你解决问题**

现在你可以开始通过GitHub Actions构建你的个人记账应用APK了！🚀