# 个人记账应用 - GitHub Actions 云端构建指南

## 🚀 概述

本项目已配置完整的GitHub Actions工作流，可以在云端自动构建Android APK文件，无需本地Java环境。

## 📋 构建触发方式

### 1. 自动触发
- **推送代码到main分支**: 每次推送代码到main分支时自动构建
- **推送代码到develop分支**: 每次推送代码到develop分支时自动构建  
- **创建Pull Request**: 向main分支创建PR时自动构建

### 2. 手动触发
1. 进入GitHub仓库页面
2. 点击 **Actions** 标签页
3. 选择 **个人记账应用 - 云端构建** 工作流
4. 点击 **Run workflow** 按钮
5. 选择分支后点击 **Run workflow**

## 🔧 构建流程

构建过程包含以下步骤：

1. **环境准备**
   - 设置Ubuntu最新版本运行环境
   - 安装JDK 17和Android SDK
   - 缓存Gradle依赖以加速构建

2. **代码检查**
   - 验证Gradle Wrapper
   - 运行Kotlin代码格式检查
   - 执行单元测试

3. **APK构建**
   - 构建Debug版本APK
   - 构建Release版本APK
   - 自动重命名APK文件（包含版本号和构建时间）

4. **文件上传**
   - 上传Debug APK到GitHub Artifacts
   - 上传Release APK到GitHub Artifacts
   - 上传测试报告和代码检查报告

## 📱 APK文件命名规则

构建完成后，APK文件将按以下格式命名：
- Debug版本: `PersonalAccounting_v{版本号}_debug_{构建时间}.apk`
- Release版本: `PersonalAccounting_v{版本号}_release_{构建时间}.apk`

例如：
- `PersonalAccounting_v1.0.0_debug_20240805_162030.apk`
- `PersonalAccounting_v1.0.0_release_20240805_162030.apk`

## 📥 下载APK文件

### 方法1: 从Actions页面下载
1. 进入GitHub仓库的 **Actions** 标签页
2. 点击最新的构建记录
3. 在页面底部的 **Artifacts** 部分下载：
   - `PersonalAccounting-Debug-APK` - Debug版本
   - `PersonalAccounting-Release-APK` - Release版本

### 方法2: 查看构建摘要
每次构建完成后，在Actions页面会显示详细的构建摘要，包括：
- 版本信息
- 提交信息
- 构建时间
- APK文件名称

## 🔍 构建状态监控

### 构建成功标志
- ✅ 绿色对勾表示构建成功
- 📱 可以下载APK文件
- 📊 可以查看测试报告

### 构建失败处理
- ❌ 红色叉号表示构建失败
- 点击失败的构建记录查看详细日志
- 检查代码错误或依赖问题
- 修复后重新推送代码触发构建

## 🛠️ 高级功能

### 1. 版本管理
- 自动从`app/build.gradle.kts`读取版本号
- 包含Git提交SHA用于版本追踪
- 构建时间戳确保文件唯一性

### 2. 缓存优化
- Gradle依赖缓存，加速后续构建
- 智能缓存策略，仅在依赖变更时重新下载

### 3. 多环境支持
- Debug版本：用于开发测试
- Release版本：用于正式发布（需要签名）

### 4. 质量检查
- Kotlin代码格式检查
- 单元测试执行
- 测试报告生成

## 📋 使用建议

1. **开发阶段**: 使用手动触发构建Debug版本进行测试
2. **版本发布**: 推送到main分支自动构建Release版本
3. **团队协作**: 通过PR触发构建确保代码质量
4. **定期清理**: GitHub Artifacts保留30天，定期下载重要版本

## 🚨 注意事项

1. **Release APK签名**: 当前Release版本为未签名APK，正式发布需要配置签名
2. **API密钥**: 百度OCR和语音识别API密钥需要在生产环境中配置
3. **权限要求**: 安装APK需要允许"未知来源"应用安装
4. **网络要求**: 构建过程需要稳定的网络连接下载依赖

## 🔗 相关链接

- [GitHub Actions文档](https://docs.github.com/en/actions)
- [Android构建指南](https://developer.android.com/studio/build)
- [Gradle构建工具](https://gradle.org/guides/)

---

通过以上配置，你可以完全在云端构建Android应用，无需担心本地Java环境问题！