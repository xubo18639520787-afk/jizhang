# Android应用签名配置指南

## 📋 概述

为了发布正式版本的Android应用，需要配置应用签名。本指南将帮助您完成签名配置。

## 🔑 生成签名密钥

### 1. 使用Android Studio生成
1. 打开Android Studio
2. 菜单栏选择 **Build** → **Generate Signed Bundle / APK**
3. 选择 **APK** 或 **Android App Bundle**
4. 点击 **Create new...** 创建新的密钥库
5. 填写密钥库信息：
   - **Key store path**: 选择保存位置（建议保存在项目外部安全位置）
   - **Password**: 设置密钥库密码
   - **Key alias**: 设置密钥别名（如：personalaccounting）
   - **Key password**: 设置密钥密码
   - **Validity**: 设置有效期（建议25年以上）
   - **Certificate**: 填写证书信息

### 2. 使用命令行生成
```bash
keytool -genkey -v -keystore release.keystore -alias personalaccounting -keyalg RSA -keysize 2048 -validity 10000
```

## ⚙️ 配置签名

### 1. 创建keystore.properties文件
在app目录下创建 `keystore.properties` 文件：

```properties
storeFile=../keystore/release.keystore
storePassword=你的密钥库密码
keyAlias=你的密钥别名
keyPassword=你的密钥密码
```

### 2. 更新build.gradle.kts
在app/build.gradle.kts中添加签名配置：

```kotlin
android {
    signingConfigs {
        create("release") {
            val keystorePropertiesFile = rootProject.file("keystore.properties")
            if (keystorePropertiesFile.exists()) {
                val keystoreProperties = Properties()
                keystoreProperties.load(FileInputStream(keystorePropertiesFile))
                
                keyAlias = keystoreProperties["keyAlias"] as String
                keyPassword = keystoreProperties["keyPassword"] as String
                storeFile = file(keystoreProperties["storeFile"] as String)
                storePassword = keystoreProperties["storePassword"] as String
            }
        }
    }
    
    buildTypes {
        release {
            isMinifyEnabled = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
            signingConfig = signingConfigs.getByName("release")
        }
    }
}
```

## 🔒 安全注意事项

1. **密钥库安全**：
   - 将密钥库文件保存在安全位置
   - 不要将密钥库文件提交到版本控制系统
   - 定期备份密钥库文件

2. **密码安全**：
   - 使用强密码
   - 不要在代码中硬编码密码
   - 将keystore.properties添加到.gitignore

3. **版本控制**：
   ```gitignore
   # 签名文件
   keystore.properties
   *.keystore
   *.jks
   ```

## 🚀 构建签名APK

### 使用Gradle命令
```bash
# 构建Release版本
./gradlew assembleRelease

# 构建并安装Release版本
./gradlew installRelease
```

### 使用GitHub Actions
GitHub Actions工作流已配置自动签名构建，只需：
1. 将签名配置添加到GitHub Secrets
2. 推送代码触发自动构建
3. 下载构建好的签名APK

## 📱 验证签名

使用以下命令验证APK签名：
```bash
# 查看APK签名信息
keytool -printcert -jarfile app-release.apk

# 验证APK签名
jarsigner -verify -verbose -certs app-release.apk
```

## 🔧 故障排除

### 常见问题：
1. **密钥库文件路径错误**：检查keystore.properties中的路径
2. **密码错误**：确认密钥库密码和密钥密码正确
3. **权限问题**：确保有读取密钥库文件的权限

### 解决方案：
- 检查文件路径是否正确
- 验证密码是否正确
- 确保密钥库文件存在且可读